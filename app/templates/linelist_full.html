{% extends "layout.html" %}
{% block title %}라인리스트 - Full tag{% endblock %}
{% block content %}
<form class="card" id="upload-form" action="{{ url_for('main.annotate_full') }}" method="post" enctype="multipart/form-data">
  <h2>Full tag (정확 문자열 매칭)</h2>

  <div class="grid-2">
    <div>
      <label>엑셀 파일 (.xlsx / .xls)</label>
      <input type="file" name="excel_file" accept=".xlsx,.xls" required />
    </div>
    <div>
      <label>PDF 파일 (.pdf)</label>
      <input type="file" name="pdf_file" accept=".pdf" required />
    </div>
  </div>

  <h3>색상 선택 (컬럼별)</h3>
  <div class="grid-4">
    <div class="color-row">
      <label>A</label>
      <input type="color" name="color_A" value="{{ defaults['A'] }}">
      <span class="hex">{{ defaults['A'] }}</span>
    </div>
    <div class="color-row">
      <label>B</label>
      <input type="color" name="color_B" value="{{ defaults['B'] }}">
      <span class="hex">{{ defaults['B'] }}</span>
    </div>
    <div class="color-row">
      <label>C</label>
      <input type="color" name="color_C" value="{{ defaults['C'] }}">
      <span class="hex">{{ defaults['C'] }}</span>
    </div>
    <div class="color-row">
      <label>D</label>
      <input type="color" name="color_D" value="{{ defaults['D'] }}">
      <span class="hex">{{ defaults['D'] }}</span>
    </div>
  </div>

  <h3>불투명도</h3>
  <div class="opacity-row">
    <input type="range" name="opacity" min="0.05" max="1.0" step="0.05" value="{{ default_opacity }}" oninput="opVal.value=this.value">
    <output id="opVal">{{ default_opacity }}</output>
  </div>

  <h3>검색 옵션</h3>
  <div class="grid-2">
    <label><input type="checkbox" name="ignore_case" checked> 대소문자 무시</label>
    <label><input type="checkbox" name="whole_word"> 완전 단어 일치</label>
  </div>

  <div class="actions">
    <button type="submit">마크업 실행</button>
    <a href="{{ url_for('main.linelist') }}" style="margin-left:8px;">← 라인리스트 메뉴</a>
  </div>
</form>

<div class="card" id="loading-state" style="display:none;">
  <h2>처리 중...</h2>
  <p>PDF 마크업 작업을 실행하고 있습니다. 파일 크기에 따라 몇 분 정도 소요될 수 있습니다.</p>
  <div class="actions">
    <a href="{{ url_for('main.linelist_full') }}" class="btn secondary">작업 취소 및 초기화</a>
  </div>
</div>

<script>
  // '마크업 실행' 버튼 클릭 시 UI 변경
  document.getElementById('upload-form').addEventListener('submit', function() {
    const excelFile = this.elements['excel_file'].files.length;
    const pdfFile = this.elements['pdf_file'].files.length;
    // 파일이 모두 선택되었을 때만 실행
    if (excelFile > 0 && pdfFile > 0) {
      document.getElementById('upload-form').style.display = 'none';
      document.getElementById('loading-state').style.display = 'block';
    }
  });

  // 색상 hex 코드 표시 갱신 (기존 기능)
  document.querySelectorAll('.color-row input[type="color"]').forEach(inp=>{
    const span = inp.parentElement.querySelector('.hex');
    inp.addEventListener('input', ()=> span.textContent = inp.value.toUpperCase());
  });
</script>
{% endblock %}