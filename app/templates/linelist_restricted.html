{% extends "layout.html" %}
{% block title %}라인리스트 - Restricted tag{% endblock %}
{% block content %}
<form class="card" id="upload-form" action="{{ url_for('main.annotate_restricted') }}" method="post" enctype="multipart/form-data">
  <h2>Restricted Mark Up</h2>
  <p class="muted">
    엑셀의 각 열 데이터를 보고 Line No인지 AI로 판단합니다. 각 <strong>시트별로</strong> 색상이 구분되어 마크업됩니다.<br>
    <strong>색상은 시트명 기반으로 자동 지정</strong>되며, 같은 시트는 항상 동일한 색으로 표시됩니다.<br><br>
    해당 프로그램은 Input 템플릿이 정해져 있으므로, 필요시 담당자에 문의 하세요.<br>
  </p>

  <div class="grid-2">
    <div>
      <label>엑셀 파일 (.xlsx / .xls)</label>
      <input type="file" name="excel_file" accept=".xlsx,.xls" required />
      <small class="muted">여러 시트를 지원합니다. 각 시트의 A/B/C 조합이 독립적으로 처리됩니다.</small>
    </div>
    <div>
      <label>PDF 파일 (.pdf)</label>
      <input type="file" name="pdf_file" accept=".pdf" required />
    </div>
  </div>

  <h3>표시 옵션</h3>
  <div class="grid-2">
    <div class="opacity-row">
      <label style="display:block;">불투명도</label>
      <input type="range" name="opacity" min="0.05" max="1.0" step="0.05" value="{{ default_opacity|default('0.35') }}" oninput="opVal.value=this.value">
      <output id="opVal">{{ default_opacity|default('0.35') }}</output>
    </div>
    <div>
      <label style="display:block;">검색 옵션</label>
      <label><input type="checkbox" name="ignore_case" checked> 대소문자 무시</label><br>
      <label><input type="checkbox" name="require_order"> A→B→C 순서 강제</label>
    </div>
  </div>

  <div class="actions">
    <button type="submit">마크업 실행</button>
    <a href="{{ url_for('main.linelist') }}" style="margin-left:8px;">← 라인리스트 메뉴</a>
  </div>
</form>

<div class="card" id="loading-state" style="display:none;">
  <h2>처리 중...</h2>
  <p>PDF 마크업 작업을 실행하고 있습니다. 파일 크기에 따라 몇 분 정도 소요될 수 있습니다.</p>
  <div class="actions">
    <a href="{{ url_for('main.linelist_restricted') }}" class="btn secondary">작업 취소 및 초기화</a>
  </div>
</div>

<script>
  // '마크업 실행' 버튼 클릭 시 UI 변경
  document.getElementById('upload-form').addEventListener('submit', function() {
    const excelFile = this.elements['excel_file'].files.length;
    const pdfFile = this.elements['pdf_file'].files.length;
    // 파일이 모두 선택되었을 때만 실행
    if (excelFile > 0 && pdfFile > 0) {
      document.getElementById('upload-form').style.display = 'none';
      document.getElementById('loading-state').style.display = 'block';
    }
  });
</script>
{% endblock %}